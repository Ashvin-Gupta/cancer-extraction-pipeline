Step 1: Loading configuration and initial cohort data...
Step 2: Joining core demographic and cancer information...

--- CHECKPOINT 1: Dataframe after joining patient and cancer info ---
Shape: (55628, 7)
Schema: Schema([('subject_id', Int64), ('is_case', Int64), ('e_pracid', Int64), ('gender', Categorical(ordering='physical')), ('yob', Int32), ('cancerdate', Datetime(time_unit='ns', time_zone=None)), ('site', Categorical(ordering='physical'))])
shape: (5, 7)
┌───────────────┬─────────┬──────────┬────────┬──────┬─────────────────────┬───────┐
│ subject_id    ┆ is_case ┆ e_pracid ┆ gender ┆ yob  ┆ cancerdate          ┆ site  │
│ ---           ┆ ---     ┆ ---      ┆ ---    ┆ ---  ┆ ---                 ┆ ---   │
│ i64           ┆ i64     ┆ i64      ┆ cat    ┆ i32  ┆ datetime[ns]        ┆ cat   │
╞═══════════════╪═════════╪══════════╪════════╪══════╪═════════════════════╪═══════╡
│ 1000242250487 ┆ 1       ┆ 50487    ┆ male   ┆ 1948 ┆ 2018-08-02 00:00:00 ┆ liver │
│ 1000724250068 ┆ 1       ┆ 50068    ┆ male   ┆ 1969 ┆ 2015-05-22 00:00:00 ┆ liver │
│ 1000802150563 ┆ 1       ┆ 50563    ┆ female ┆ 1946 ┆ 2016-02-25 00:00:00 ┆ liver │
│ 1000961151109 ┆ 1       ┆ 51109    ┆ male   ┆ 1947 ┆ 2018-09-24 00:00:00 ┆ liver │
│ 1000972950560 ┆ 1       ┆ 50560    ┆ male   ┆ 1934 ┆ 2015-09-05 00:00:00 ┆ liver │
└───────────────┴─────────┴──────────┴────────┴──────┴─────────────────────┴───────┘
------------------------------------------------------------
Step 3: Preparing the region lookup table...

--- CHECKPOINT 2: The prepared region lookup table ---
Shape: (1471, 2)
Schema: Schema([('e_pracid', Int64), ('region', Int64)])
shape: (5, 2)
┌──────────┬────────┐
│ e_pracid ┆ region │
│ ---      ┆ ---    │
│ i64      ┆ i64    │
╞══════════╪════════╡
│ 51394    ┆ 7      │
│ 50870    ┆ 2      │
│ 51216    ┆ 5      │
│ 50275    ┆ 8      │
│ 50522    ┆ 7      │
└──────────┴────────┘
------------------------------------------------------------

--- CHECKPOINT 3: Dataframe after joining region info ---
Shape: (55628, 8)
Schema: Schema([('subject_id', Int64), ('is_case', Int64), ('e_pracid', Int64), ('gender', Categorical(ordering='physical')), ('yob', Int32), ('cancerdate', Datetime(time_unit='ns', time_zone=None)), ('site', Categorical(ordering='physical')), ('region', Int64)])
shape: (5, 8)
┌───────────────┬─────────┬──────────┬────────┬──────┬─────────────────────┬───────┬────────┐
│ subject_id    ┆ is_case ┆ e_pracid ┆ gender ┆ yob  ┆ cancerdate          ┆ site  ┆ region │
│ ---           ┆ ---     ┆ ---      ┆ ---    ┆ ---  ┆ ---                 ┆ ---   ┆ ---    │
│ i64           ┆ i64     ┆ i64      ┆ cat    ┆ i32  ┆ datetime[ns]        ┆ cat   ┆ i64    │
╞═══════════════╪═════════╪══════════╪════════╪══════╪═════════════════════╪═══════╪════════╡
│ 1000242250487 ┆ 1       ┆ 50487    ┆ male   ┆ 1948 ┆ 2018-08-02 00:00:00 ┆ liver ┆ 5      │
│ 1000724250068 ┆ 1       ┆ 50068    ┆ male   ┆ 1969 ┆ 2015-05-22 00:00:00 ┆ liver ┆ 7      │
│ 1000802150563 ┆ 1       ┆ 50563    ┆ female ┆ 1946 ┆ 2016-02-25 00:00:00 ┆ liver ┆ 3      │
│ 1000961151109 ┆ 1       ┆ 51109    ┆ male   ┆ 1947 ┆ 2018-09-24 00:00:00 ┆ liver ┆ 3      │
│ 1000972950560 ┆ 1       ┆ 50560    ┆ male   ┆ 1934 ┆ 2015-09-05 00:00:00 ┆ liver ┆ 2      │
└───────────────┴─────────┴──────────┴────────┴──────┴─────────────────────┴───────┴────────┘
Any nulls in 'region' column? False
------------------------------------------------------------
Step 4a: Getting primary ethnicity from HES data...
shape: (5, 9)
┌───────────────┬─────────┬──────────┬────────┬───┬───────────────┬───────┬────────┬───────────────┐
│ subject_id    ┆ is_case ┆ e_pracid ┆ gender ┆ … ┆ cancerdate    ┆ site  ┆ region ┆ primary_ethni │
│ ---           ┆ ---     ┆ ---      ┆ ---    ┆   ┆ ---           ┆ ---   ┆ ---    ┆ city          │
│ i64           ┆ i64     ┆ i64      ┆ cat    ┆   ┆ datetime[ns]  ┆ cat   ┆ i64    ┆ ---           │
│               ┆         ┆          ┆        ┆   ┆               ┆       ┆        ┆ str           │
╞═══════════════╪═════════╪══════════╪════════╪═══╪═══════════════╪═══════╪════════╪═══════════════╡
│ 1000242250487 ┆ 1       ┆ 50487    ┆ male   ┆ … ┆ 2018-08-02    ┆ liver ┆ 5      ┆ White         │
│               ┆         ┆          ┆        ┆   ┆ 00:00:00      ┆       ┆        ┆               │
│ 1000724250068 ┆ 1       ┆ 50068    ┆ male   ┆ … ┆ 2015-05-22    ┆ liver ┆ 7      ┆ Bl_Afric      │
│               ┆         ┆          ┆        ┆   ┆ 00:00:00      ┆       ┆        ┆               │
│ 1000802150563 ┆ 1       ┆ 50563    ┆ female ┆ … ┆ 2016-02-25    ┆ liver ┆ 3      ┆ Unknown       │
│               ┆         ┆          ┆        ┆   ┆ 00:00:00      ┆       ┆        ┆               │
│ 1000961151109 ┆ 1       ┆ 51109    ┆ male   ┆ … ┆ 2018-09-24    ┆ liver ┆ 3      ┆ White         │
│               ┆         ┆          ┆        ┆   ┆ 00:00:00      ┆       ┆        ┆               │
│ 1000972950560 ┆ 1       ┆ 50560    ┆ male   ┆ … ┆ 2015-09-05    ┆ liver ┆ 2      ┆ White         │
│               ┆         ┆          ┆        ┆   ┆ 00:00:00      ┆       ┆        ┆               │
└───────────────┴─────────┴──────────┴────────┴───┴───────────────┴───────┴────────┴───────────────┘
Step 4b: Preparing fallback for subjects with missing ethnicity...
Found 7356 subjects needing fallback ethnicity search.
