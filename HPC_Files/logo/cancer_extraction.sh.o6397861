--- Debugging Two-Step (Medcode -> SNOMED -> ICD-10) Mapping ---

Step 1: Getting a sample of raw codes from your sorted events...
Found 10000 unique raw codes to check.

Step 2: Loading the Medcode->SNOMED and SNOMED->ICD10 maps...
Loaded 247118 Medcode-to-SNOMED rules.
Loaded 958204 active SNOMED-to-ICD10 rules.

Step 3: Performing two-step INNER join to find end-to-end matches...

--- DEBUG RESULTS ---
Initial unique codes to check: 10000
Codes with a SNOMED mapping: 10000
Codes that completed the full mapping to ICD-10: 8827

✅ Success! Found 8827 complete matches. The mapping logic is working.
  -> Of these, 1635 map to a meaningful ICD-10 code (not '#NIS' or '#NC').
shape: (10, 3)
┌──────────────────┬───────────────────┬───────────┐
│ raw_code         ┆ SnomedCTConceptId ┆ mapTarget │
│ ---              ┆ ---               ┆ ---       │
│ str              ┆ str               ┆ str       │
╞══════════════════╪═══════════════════╪═══════════╡
│ 267383016        ┆ 386556002         ┆ D149      │
│ 2871428016       ┆ 445265001         ┆ S708      │
│ 272215014        ┆ 15617002          ┆ L845      │
│ 1221208011       ┆ 15617002          ┆ L845      │
│ 271157012        ┆ 175076003         ┆ K511      │
│ 274477012        ┆ 177278007         ┆ S066      │
│ 2252131000000112 ┆ 871751000000104   ┆ X448      │
│ 865051000006119  ┆ 585471000000109   ┆ K233      │
│ 865081000006110  ┆ 585471000000109   ┆ K233      │
│ 347105014        ┆ 231608004         ┆ C205      │
└──────────────────┴───────────────────┴───────────┘
Here is a sample of the successful matches:
shape: (10, 3)
┌──────────────────┬───────────────────┬───────────┐
│ raw_code         ┆ SnomedCTConceptId ┆ mapTarget │
│ ---              ┆ ---               ┆ ---       │
│ str              ┆ str               ┆ str       │
╞══════════════════╪═══════════════════╪═══════════╡
│ 1485101012       ┆ 1083701000000107  ┆ #NIS      │
│ 252364016        ┆ 161933007         ┆ #NIS      │
│ 267383016        ┆ 386556002         ┆ D149      │
│ 2342371000000119 ┆ 1002431000000100  ┆ #NIS      │
│ 2871428016       ┆ 445265001         ┆ S708      │
│ 406371000000117  ┆ 248171000000108   ┆ #NIS      │
│ 272215014        ┆ 15617002          ┆ L845      │
│ 1221208011       ┆ 15617002          ┆ L845      │
│ 339871012        ┆ 226207007         ┆ #NIS      │
│ 1787466016       ┆ 995541000000107   ┆ #NIS      │
└──────────────────┴───────────────────┴───────────┘
