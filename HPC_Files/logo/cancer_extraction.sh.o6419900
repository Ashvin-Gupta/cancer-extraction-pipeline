--- Debugging Two-Step (Medcode -> SNOMED -> ICD-10) Mapping ---

Step 1: Getting a sample of raw codes from your sorted events...
Found 10000 unique raw codes to check.

Step 2: Loading the Medcode->SNOMED and SNOMED->ICD10 maps...
Loaded 247118 Medcode-to-SNOMED rules.
Loaded 958204 active SNOMED-to-ICD10 rules.

Step 3: Performing two-step INNER join to find end-to-end matches...

--- DEBUG RESULTS ---
Initial unique codes to check: 10000
Codes with a SNOMED mapping: 10000
Codes that completed the full mapping to ICD-10: 8807

✅ Success! Found 8807 complete matches. The mapping logic is working.
  -> Of these, 1629 map to a meaningful ICD-10 code (not '#NIS' or '#NC').
shape: (30, 3)
┌───────────────────┬───────────────────┬───────────┐
│ raw_code          ┆ SnomedCTConceptId ┆ mapTarget │
│ ---               ┆ ---               ┆ ---       │
│ str               ┆ str               ┆ str       │
╞═══════════════════╪═══════════════════╪═══════════╡
│ 336281000006118   ┆ 244002004         ┆ O311      │
│ 745901000000115   ┆ 178609006         ┆ V681      │
│ 1702221000006112  ┆ 178609006         ┆ V681      │
│ 357101000000111   ┆ 105377009         ┆ U216      │
│ 276617014         ┆ 178771000         ┆ V496      │
│ …                 ┆ …                 ┆ …         │
│ 13486801000006116 ┆ 390865008         ┆ X443      │
│ 4180211000006115  ┆ 110473004         ┆ #HLT      │
│ 272906014         ┆ 302363000         ┆ M628      │
│ 98121000006118    ┆ 265160007         ┆ W382      │
│ 794541000006111   ┆ 265160007         ┆ W382      │
└───────────────────┴───────────────────┴───────────┘
Here is a sample of the successful matches:
shape: (30, 3)
┌──────────────────┬───────────────────┬───────────┐
│ raw_code         ┆ SnomedCTConceptId ┆ mapTarget │
│ ---              ┆ ---               ┆ ---       │
│ str              ┆ str               ┆ str       │
╞══════════════════╪═══════════════════╪═══════════╡
│ 1166521000000111 ┆ 522381000000101   ┆ #NC       │
│ 1887071000006119 ┆ 882981000000105   ┆ #NIS      │
│ 254610014        ┆ 163434000         ┆ #NIS      │
│ 336281000006118  ┆ 244002004         ┆ O311      │
│ 84481000006116   ┆ 443694000         ┆ #NIS      │
│ …                ┆ …                 ┆ …         │
│ 2579530018       ┆ 396080005         ┆ #NC       │
│ 868971000006116  ┆ 17293009          ┆ N171      │
│ 478103014        ┆ 17293009          ┆ N171      │
│ 2774281000006111 ┆ 17293009          ┆ N171      │
│ 250620014        ┆ 160774006         ┆ #NIS      │
└──────────────────┴───────────────────┴───────────┘
